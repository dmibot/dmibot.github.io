<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Mikrotik Load Balance Tools | dmibot</title>
<link rel="icon" href="https://dmibot.github.io/Mikrotik.svg">
<style>
  body{margin:0;font-family:"Segoe UI",sans-serif;background:#f8fff8;color:#333;}
  header{
    background:#4CAF50;color:#fff;text-align:center;position:relative;
    padding:25px 10px;border-bottom:5px solid #388E3C;
  }
  header img{width:80px;vertical-align:middle;}
  header h1{margin:10px 0 5px;font-size:1.8rem;}
  header p{margin:0;font-size:1rem;opacity:.9;}
  .home-btn{
    position:absolute;left:15px;top:15px;background:#fff;color:#4CAF50;
    border:none;padding:8px 14px;border-radius:8px;font-weight:bold;cursor:pointer;
    box-shadow:0 2px 5px rgba(0,0,0,.2);transition:.2s;
  }
  .home-btn:hover{background:#c8facc;}
  main{max-width:1000px;margin:30px auto;padding:0 20px;}
  .tabs{display:flex;flex-wrap:wrap;justify-content:center;gap:8px;margin-bottom:20px;}
  .tabs button{background:#4CAF50;color:#fff;border:none;padding:10px 18px;border-radius:8px;cursor:pointer;font-weight:600;}
  .tabs button.active{background:#2e7d32;}
  .card{background:#fff;padding:20px;border-radius:14px;box-shadow:0 3px 8px rgba(0,0,0,0.1);}
  textarea{width:100%;height:180px;margin-top:10px;padding:10px;font-family:monospace;font-size:.9rem;border-radius:8px;border:1px solid #ccc;resize:vertical;}
  footer{text-align:center;color:#666;padding:20px;margin-top:40px;font-size:.9rem;}
  .hidden{display:none;}
</style>
</head>
<body>
<header>
  <button class="home-btn" onclick="window.location.href='index.html'">üè† Home</button>
  <img src="https://dmibot.github.io/Mikrotik.svg" alt="Mikrotik Logo">
  <h1>Mikrotik Load Balance Tools</h1>
  <p>by dmibot</p>
</header>

<main>
  <div class="tabs">
    <button id="tab1" class="active" onclick="openTab(1)">üß± Basic Setup</button>
    <button id="tab2" onclick="openTab(2)">üß≠ Routing & PCC</button>
    <button id="tab3" onclick="openTab(3)">‚öôÔ∏è Gabungkan Config</button>
  </div>

  <div id="section1" class="card"></div>
  <div id="section2" class="card hidden"></div>
  <div id="section3" class="card hidden">
    <h2>‚öôÔ∏è Gabungkan Konfigurasi</h2>
    <p>Klik tombol di bawah untuk menggabungkan hasil dari Basic Setup dan Routing & PCC menjadi satu konfigurasi lengkap.</p>
    <button onclick="combineConfigs()">Gabungkan Konfigurasi</button>
    <button onclick="copyAll()">Copy All Config</button>
    <textarea id="combinedOutput" readonly></textarea>
  </div>
</main>

<footer>¬© 2025 dmibot | Mikrotik Tools Portal</footer>

<script>
// === Info pop-up dua bahasa ===
window.addEventListener('load',()=>{
  alert(
"üáÆüá© Bahasa Indonesia\n"+
"Mikrotik Load Balance PCC Tools by @dmibot\n\n"+
"Tools ini membantu membuat konfigurasi otomatis untuk RouterOS v6 dan v7 dalam dua tahap utama:\n\n"+
"1Ô∏è‚É£ Basic Setup\nBerfungsi untuk membangun struktur jaringan dasar, mencakup:\n"+
"- Pembuatan Bridge-LAN dan port-port LAN\n"+
"- DHCP-Client pada setiap interface ISP\n"+
"- Pembuatan DHCP-Server untuk LAN\n"+
"- Konfigurasi DNS & DoH secara otomatis\n\n"+
"2Ô∏è‚É£ Routing & PCC\nBerfungsi untuk mengatur pembagian beban koneksi dan failover otomatis:\n"+
"- Pembuatan mark-connection & mark-routing per ISP\n"+
"- Routing Table otomatis sesuai nama ISP (RouterOS v7)\n"+
"- Dukungan failover mode Recursive & Local\n"+
"- Bypass jaringan lokal agar tidak ikut load balance\n\n"+
"Gunakan tab di atas untuk menghasilkan konfigurasi langkah demi langkah.\n"+
"Setelah selesai, gunakan tab 'Gabungkan Config' untuk menyatukan semua hasil menjadi satu script lengkap.\n\n"+
"========================\n\n"+
"üá¨üáß English Version\n"+
"Mikrotik Load Balance PCC Tools by @dmibot\n\n"+
"This tool helps you automatically generate configuration for RouterOS v6 and v7 in two main stages:\n\n"+
"1Ô∏è‚É£ Basic Setup\nUsed to build the base network structure, including:\n"+
"- Creating Bridge-LAN and adding LAN ports\n"+
"- Adding DHCP-Client on each ISP interface\n"+
"- Creating DHCP-Server for the LAN\n"+
"- Automatically configuring DNS & DoH\n\n"+
"2Ô∏è‚É£ Routing & PCC\nUsed to configure connection load balancing and automatic failover:\n"+
"- Creating connection & routing marks per ISP\n"+
"- Auto Routing Table based on ISP names (RouterOS v7)\n"+
"- Supports both Recursive & Local failover modes\n"+
"- Bypasses local networks from load balancing\n\n"+
"Use the tabs above to generate configuration step by step.\n"+
"After that, use the 'Combine Config' tab to merge all results into one complete script."
  );
});

function openTab(num){
  document.querySelectorAll('.tabs button').forEach(btn=>btn.classList.remove('active'));
  document.querySelectorAll('main .card').forEach(sec=>sec.classList.add('hidden'));
  document.getElementById('tab'+num).classList.add('active');
  document.getElementById('section'+num).classList.remove('hidden');
}

function combineConfigs(){
  const basic = window.basicOutput || "";
  const routing = window.routingOutput || "";
  document.getElementById("combinedOutput").value = basic + "\n\n" + routing;
  openTab(3);
}

function copyAll(){
  const ta=document.getElementById("combinedOutput");
  ta.select();ta.setSelectionRange(0,99999);
  navigator.clipboard.writeText(ta.value);
  alert("‚úÖ All Config Copied!");
}
</script>

<!-- module scripts -->
<script src="modules/lb_basic_setup.js"></script>
<script src="modules/lb_routing_pcc.js"></script>

<section class="card" style="margin-top:16px">
  <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
    <strong id="tw-consent-label">Geolocation Consent</strong>
    <label class="switch">
      <input type="checkbox" id="tw-consent-toggle">
      <span class="slider"></span>
    </label>
    <span id="tw-consent-state" class="muted"></span>
  </div>
</section>
<script type="module">
  import { getConsent, setConsent } from './modules/ui/consent.js';
  import { t } from './modules/ui/i18n.js';
  const label = document.getElementById('tw-consent-label');
  const toggle = document.getElementById('tw-consent-toggle');
  const state = document.getElementById('tw-consent-state');

  function updateTexts(){
    label.textContent = t('consent');
  }
  function updateState(val){
    if (val === null){ state.textContent = t('statusNotSet'); toggle.checked = false; }
    else if (val){ state.textContent = t('statusAllowed'); toggle.checked = true; }
    else { state.textContent = t('statusDeclined'); toggle.checked = false; }
  }

  updateTexts();
  const cur = getConsent();
  updateState(cur);

  toggle.addEventListener('change', (e)=>{
    const v = !!e.target.checked;
    setConsent(v);
    updateState(v);
    document.dispatchEvent(new CustomEvent('dmibot:consent-change', { detail: v }));
  });

  document.addEventListener('dmibot:consent-change', (e)=>{
    updateState(e.detail);
  });
</script>


<section class="card" style="margin-top:16px">
  <h3 style="margin:0 10px 10px 0;display:inline-block">Presets</h3>
  <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
    <select id="pz-list" class="input" style="max-width:220px"></select>
    <input id="pz-name" class="input" placeholder="Preset name" style="max-width:220px">
    <button class="btn" id="pz-save">Save</button>
    <button class="btn" id="pz-load" style="background:#6366f1">Load</button>
    <button class="btn" id="pz-del" style="background:#ef4444">Delete</button>
  </div>
</section>
<script type="module">
  import { listPresets, savePreset, loadPreset, deletePreset, serializeScope, applyScope } from './modules/ui/presets.js';
  const KEY = document.title.replace(/\s+/g,'_').toLowerCase() || 'dmibot_tool';
  const list = document.getElementById('pz-list');
  const name = document.getElementById('pz-name');
  const btnSave = document.getElementById('pz-save');
  const btnLoad = document.getElementById('pz-load');
  const btnDel  = document.getElementById('pz-del');

  function refresh(){
    const items = listPresets(KEY);
    list.innerHTML = items.map(n=>`<option value="${n}">${n}</option>`).join('');
  }
  refresh();

  btnSave?.addEventListener('click', ()=>{
    const nm = name.value.trim() || prompt('Preset name?');
    if(!nm) return;
    const data = serializeScope(document);
    savePreset(KEY, nm, data);
    refresh(); name.value = nm; alert('Preset saved: '+nm);
  });
  btnLoad?.addEventListener('click', ()=>{
    const nm = name.value.trim() || list.value;
    if(!nm){ alert('Select or type a preset name'); return; }
    const data = loadPreset(KEY, nm);
    if(!data){ alert('Preset not found'); return; }
    applyScope(data, document);
    alert('Loaded: '+nm);
  });
  btnDel?.addEventListener('click', ()=>{
    const nm = name.value.trim() || list.value;
    if(!nm){ alert('Select or type a preset name'); return; }
    if(!confirm('Delete preset '+nm+'?')) return;
    deletePreset(KEY, nm); refresh(); alert('Deleted: '+nm);
  });
  list?.addEventListener('change', ()=>{ name.value = list.value; });
</script>

</body>
</html>
