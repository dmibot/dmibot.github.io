<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>PBR Game Calculator | dmibot</title>
<link rel="icon" href="https://dmibot.github.io/Mikrotik.svg">
<style>
  body{margin:0;font-family:"Segoe UI",sans-serif;background:#f8fff8;color:#333;}
  header{
    background:#4CAF50;color:#fff;text-align:center;position:relative;
    padding:25px 10px;border-bottom:5px solid #388E3C;
  }
  header img{width:70px;vertical-align:middle;}
  header h1{margin:10px 0 5px;font-size:1.6rem;}
  header p{margin:0;font-size:.9rem;opacity:.9;}
  .home-btn{
    position:absolute;left:15px;top:15px;background:#fff;color:#4CAF50;
    border:none;padding:7px 12px;border-radius:8px;font-weight:bold;cursor:pointer;
    box-shadow:0 2px 5px rgba(0,0,0,.2);transition:.2s;
  }
  .home-btn:hover{background:#c8facc;}
  main{max-width:800px;margin:25px auto;padding:20px;background:#fff;border-radius:14px;
       box-shadow:0 3px 8px rgba(0,0,0,0.1);}
  label{display:block;margin-top:10px;font-weight:500;}
  input,select,textarea{width:100%;padding:8px;margin-top:4px;border:1px solid #ccc;
               border-radius:6px;box-sizing:border-box;font-size:.9rem;}
  select[multiple]{height:200px;}
  button{background:#4CAF50;color:#fff;border:none;padding:10px 18px;border-radius:8px;
         cursor:pointer;font-weight:bold;margin:10px 5px 0 0;}
  button:hover{background:#2e7d32;}
  textarea{height:150px;font-family:monospace;font-size:.9rem;resize:vertical;}
  footer{text-align:center;color:#666;padding:15px;margin-top:30px;font-size:.85rem;}
  .manual-block{border:1px solid #ddd;padding:10px;border-radius:8px;margin-top:10px;background:#f9f9f9;}
</style>
</head>
<body>
<header>
  <button class="home-btn" onclick="window.location.href='index.html'">üè† Home</button>
  <img src="https://dmibot.github.io/Mikrotik.svg" alt="Mikrotik Logo">
  <h1>PBR Game Calculator</h1>
  <p>by dmibot</p>
</header>

<main>
  <h2 style="text-align:center;color:#388E3C;">‚öôÔ∏è Multi Game Policy Based Routing Generator</h2>

  <!-- RouterOS & ISP Section -->
  <label>Versi RouterOS:</label>
  <select id="rosVer">
    <option value="6">RouterOS v6</option>
    <option value="7" selected>RouterOS v7</option>
  </select>

  <label>Nama ISP (Prefix Route):</label>
  <input id="ispName" placeholder="contoh: to_Telkom">

  <label>ISP Interface (ISP yang dipilih untuk PBR):</label>
  <input id="ispInterface" placeholder="contoh: ether4" value="ether4">

  <label>IP Gateway ISP:</label>
  <input id="ispGateway" placeholder="contoh: 172.16.0.1" value="172.16.0.1">

  <!-- Game Preset -->
  <label>Pilih Game Preset (bisa pilih lebih dari satu):</label>
  <select id="gameSelect" multiple>
    <option value="Mobile Legends">Mobile Legends</option>
    <option value="Free Fire">Free Fire</option>
    <option value="PUBG Mobile">PUBG Mobile</option>
    <option value="Call of Duty">Call of Duty Mobile</option>
    <option value="Arena of Valor">Arena of Valor (AOV)</option>
    <option value="Stumble Guys">Stumble Guys</option>
    <option value="Genshin Impact">Genshin Impact</option>
    <option value="Clash of Clans">Clash of Clans / Royale</option>
    <option value="League of Legends">League of Legends Mobile</option>
    <option value="DOTA2">DOTA2</option>
    <option value="FIFA Online">FIFA Online</option>
    <option value="Point Blank Mobile">Point Blank Mobile</option>
    <option value="LINE Get Rich">LINE Let‚Äôs Get Rich</option>
    <option value="Dream League Soccer">Dream League Soccer</option>
    <option value="Among Us">Among Us</option>
    <option value="Roblox">Roblox</option>
  </select>

  <!-- Manual Game Input Section -->
  <div id="manualContainer" style="margin-top:15px;">
    <h3>üéÆ Game Manual (Optional)</h3>
    <div id="manualGameList"></div>
    <button id="addManualBtn" type="button">+ Tambah Game Manual</button>
  </div>

  <!-- QoS Settings -->
  <label>Priority (0=lowest, 1=highest):</label>
  <select id="priority">
    <option value="1" selected>1 (Highest)</option>
    <option value="2">2</option><option value="3">3</option>
    <option value="4">4</option><option value="5">5</option>
    <option value="6">6</option><option value="7">7</option>
    <option value="8">8 (Lowest)</option>
  </select>

  <label>Bandwidth Upload (default 5M):</label>
  <input id="bwUp" placeholder="contoh: 5M">

  <label>Bandwidth Download (default 5M):</label>
  <input id="bwDown" placeholder="contoh: 5M">

  <div style="text-align:center;margin-top:15px;">
    <button id="generateBtn">Generate Script</button>
    <button id="copyBasic">Copy Basic</button>
    <button id="copyRouting">Copy Routing</button>
  </div>

  <h3>üìú Konfigurasi Dasar</h3>
  <textarea id="outputBasic" readonly></textarea>

  <h3>üß≠ Konfigurasi Routing</h3>
  <textarea id="outputRouting" readonly></textarea>
</main>

<footer>¬© 2025 dmibot | PBR Game Calculator</footer>

<script>
// === Pop-up Dua Bahasa ===
window.addEventListener('load',()=>{
  alert(
"üáÆüá© Bahasa Indonesia\n"+
"Versi terbaru PBR Game Calculator by @dmibot.\n"+
"Sekarang kamu bisa memilih beberapa game preset sekaligus, dan juga menambahkan beberapa game manual dalam satu konfigurasi.\n\n"+
"========================\n\n"+
"üá¨üáß English Version\n"+
"Now you can select multiple preset games and add multiple custom games in one configuration.\n"+
"Fully adaptive and automatic routing, mangle, and QoS generation."
  );
});

// === Manual Game Control ===
document.getElementById('addManualBtn').addEventListener('click',()=>{
  const container = document.getElementById('manualGameList');
  const div = document.createElement('div');
  div.className = 'manual-block';
  div.innerHTML = `
    <label>Nama Game Manual:</label>
    <input class="manualName" placeholder="contoh: Apex Legends">
    <label>Port Game Manual:</label>
    <textarea class="manualPort" placeholder="Format:\ntcp: 80,443\nudp: 7000-7999"></textarea>
  `;
  container.appendChild(div);
});
</script>

<!-- JS Logic -->
<script src="modules/pbr_game_calculator.js"></script>

<section class="card" style="margin-top:16px">
  <div style="display:flex;align-items:center;gap:10px;flex-wrap:wrap">
    <strong id="tw-consent-label">Geolocation Consent</strong>
    <label class="switch">
      <input type="checkbox" id="tw-consent-toggle">
      <span class="slider"></span>
    </label>
    <span id="tw-consent-state" class="muted"></span>
  </div>
</section>
<script type="module">
  import { getConsent, setConsent } from './modules/ui/consent.js';
  import { t } from './modules/ui/i18n.js';
  const label = document.getElementById('tw-consent-label');
  const toggle = document.getElementById('tw-consent-toggle');
  const state = document.getElementById('tw-consent-state');

  function updateTexts(){
    label.textContent = t('consent');
  }
  function updateState(val){
    if (val === null){ state.textContent = t('statusNotSet'); toggle.checked = false; }
    else if (val){ state.textContent = t('statusAllowed'); toggle.checked = true; }
    else { state.textContent = t('statusDeclined'); toggle.checked = false; }
  }

  updateTexts();
  const cur = getConsent();
  updateState(cur);

  toggle.addEventListener('change', (e)=>{
    const v = !!e.target.checked;
    setConsent(v);
    updateState(v);
    document.dispatchEvent(new CustomEvent('dmibot:consent-change', { detail: v }));
  });

  document.addEventListener('dmibot:consent-change', (e)=>{
    updateState(e.detail);
  });
</script>


<section class="card" style="margin-top:16px">
  <h3 style="margin:0 10px 10px 0;display:inline-block">Presets</h3>
  <div style="display:flex;gap:8px;flex-wrap:wrap;align-items:center">
    <select id="pz-list" class="input" style="max-width:220px"></select>
    <input id="pz-name" class="input" placeholder="Preset name" style="max-width:220px">
    <button class="btn" id="pz-save">Save</button>
    <button class="btn" id="pz-load" style="background:#6366f1">Load</button>
    <button class="btn" id="pz-del" style="background:#ef4444">Delete</button>
  </div>
</section>
<script type="module">
  import { listPresets, savePreset, loadPreset, deletePreset, serializeScope, applyScope } from './modules/ui/presets.js';
  const KEY = document.title.replace(/\s+/g,'_').toLowerCase() || 'dmibot_tool';
  const list = document.getElementById('pz-list');
  const name = document.getElementById('pz-name');
  const btnSave = document.getElementById('pz-save');
  const btnLoad = document.getElementById('pz-load');
  const btnDel  = document.getElementById('pz-del');

  function refresh(){
    const items = listPresets(KEY);
    list.innerHTML = items.map(n=>`<option value="${n}">${n}</option>`).join('');
  }
  refresh();

  btnSave?.addEventListener('click', ()=>{
    const nm = name.value.trim() || prompt('Preset name?');
    if(!nm) return;
    const data = serializeScope(document);
    savePreset(KEY, nm, data);
    refresh(); name.value = nm; alert('Preset saved: '+nm);
  });
  btnLoad?.addEventListener('click', ()=>{
    const nm = name.value.trim() || list.value;
    if(!nm){ alert('Select or type a preset name'); return; }
    const data = loadPreset(KEY, nm);
    if(!data){ alert('Preset not found'); return; }
    applyScope(data, document);
    alert('Loaded: '+nm);
  });
  btnDel?.addEventListener('click', ()=>{
    const nm = name.value.trim() || list.value;
    if(!nm){ alert('Select or type a preset name'); return; }
    if(!confirm('Delete preset '+nm+'?')) return;
    deletePreset(KEY, nm); refresh(); alert('Deleted: '+nm);
  });
  list?.addEventListener('change', ()=>{ name.value = list.value; });
</script>

</body>
</html>
